const hre = require("hardhat");
const { ethers } = require("ethers");

async function main() {
  const [deployer] = await hre.ethers.getSigners();

  console.log("Deploying contracts with the account:", deployer.address);

  // Use the same Create2Deployer address across all chains
  const CREATE2_DEPLOYER_ADDRESS = "0x13b0D85CcB8bf860b6b79AF3029fCA081AE9beF2";
  const Create2Deployer = await hre.ethers.getContractFactory("Create2Deployer");
  const WormholeDeployer ="0x608060405234801561001057600080fd5b506115f2806100206000396000f3fe60806040526004361061007f5760003560e01c8063c87ffe3c1161004e578063c87ffe3c14610148578063ca9ffe941461015b578063cdcb760a1461017b578063da25b7251461019b57600080fd5b80633e75b90c1461008b578063529dca32146100c857806383281452146100dd578063c4d66de81461010b57600080fd5b3661008657005b600080fd5b34801561009757600080fd5b506100ab6100a6366004610d47565b6101bb565b6040516001600160a01b0390911681526020015b60405180910390f35b6100db6100d6366004610dff565b6103d0565b005b3480156100e957600080fd5b506100fd6100f8366004610f78565b6104c0565b6040519081526020016100bf565b34801561011757600080fd5b506100db610126366004610fca565b600080546001600160a01b0319166001600160a01b0392909216919091179055565b6100db610156366004611056565b61059f565b34801561016757600080fd5b506100ab61017636600461111c565b6108da565b34801561018757600080fd5b506100ab61019636600461111c565b6108f6565b3480156101a757600080fd5b506000546100ab906001600160a01b031681565b6040516366e5bb0560e11b81526000908190309063cdcb760a906101e590899089906004016111b3565b6020604051808303816000875af1925050508015610220575060408051601f3d908101601f1916820190925261021d918101906111cc565b60015b6102d65761022c6111e9565b806308c379a00361028b5750610240611205565b8061024b575061028d565b8060405160200161025c919061128f565b60408051601f198184030181529082905262461bcd60e51b8252610282916004016112ca565b60405180910390fd5b505b3d8080156102b7576040519150601f19603f3d011682016040523d82523d6000602084013e6102bc565b606091505b506102c681610904565b60405160200161025c91906112dd565b604080516001600160a01b03831681526020810189905291925082917fb085ff794f342ed78acc7791d067e28a931e614b52476c0305795e1ff0a154bc910160405180910390a15083156103c7576000816001600160a01b03168460405161033e9190611333565b6000604051808303816000865af19150503d806000811461037b576040519150601f19603f3d011682016040523d82523d6000602084013e610380565b606091505b50509050806103c55760405162461bcd60e51b81526020600482015260116024820152701a5b9a5d1a585b1a5e994819985a5b1959607a1b6044820152606401610282565b505b95945050505050565b600080600080888060200190518101906103ea919061139e565b93509350935093506000610400848685856101bb565b9050600061040e85876108da565b9050806001600160a01b0316826001600160a01b0316146104715760405162461bcd60e51b815260206004820152601b60248201527f4465706c6f796d656e742061646472657373206d69736d6174636800000000006044820152606401610282565b604080516001600160a01b0384168152602081018790527fb085ff794f342ed78acc7791d067e28a931e614b52476c0305795e1ff0a154bc910160405180910390a15050505050505050505050565b600080805b8351811015610598576000805485516001600160a01b039091169063c23ee3c3908790859081106104f8576104f8611413565b60209081029190910101516040516001600160e01b031960e084901b16815261ffff909116600482015260006024820152622dc6c060448201526064016040805180830381865afa158015610551573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105759190611429565b5090506105828184611463565b925050808061059090611476565b9150506104c5565b5092915050565b60006105ab84866108da565b905060005b875181101561081c576000868686866040516020016105d2949392919061148f565b604051602081830303815290604052905060008060009054906101000a90046001600160a01b03166001600160a01b031663c23ee3c38b858151811061061a5761061a611413565b60209081029190910101516040516001600160e01b031960e084901b16815261ffff909116600482015260006024820152622dc6c060448201526064016040805180830381865afa158015610673573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106979190611429565b509050803410156106f45760405162461bcd60e51b815260206004820152602160248201527f496e73756666696369656e742066756e647320666f72206465706c6f796d656e6044820152601d60fa1b6064820152608401610282565b6000548a516001600160a01b0390911690638fecdd029083908d908790811061071f5761071f611413565b60200260200101518c878151811061073957610739611413565b6020026020010151866000622dc6c06040518763ffffffff1660e01b81526004016107689594939291906114cd565b60206040518083038185885af1935050505080156107a3575060408051601f3d908101601f191682019092526107a09181019061150f565b60015b610806576107af6111e9565b806308c379a0036107fa57506107c3611205565b806107ce57506107fc565b8a84815181106107e0576107e0611413565b60200260200101518160405160200161025c929190611539565b505b3d6000803e3d6000fd5b505050808061081490611476565b9150506105b0565b50600061082b858786866101bb565b9050816001600160a01b0316816001600160a01b03161461088e5760405162461bcd60e51b815260206004820152601b60248201527f4465706c6f796d656e742061646472657373206d69736d6174636800000000006044820152606401610282565b604080516001600160a01b0383168152602081018790527fb085ff794f342ed78acc7791d067e28a931e614b52476c0305795e1ff0a154bc910160405180910390a15050505050505050565b60006108ed838380519060200120610b1d565b90505b92915050565b60006108ed60008484610b2a565b60408051808201909152601081526f181899199a1a9b1b9c1cb0b131b232b360811b602082015281516060919060009061093f9060026115a5565b61094a906002611463565b67ffffffffffffffff81111561096257610962610c5f565b6040519080825280601f01601f19166020018201604052801561098c576020820181803683370190505b509050600360fc1b816000815181106109a7576109a7611413565b60200101906001600160f81b031916908160001a905350600f60fb1b816001815181106109d6576109d6611413565b60200101906001600160f81b031916908160001a90535060005b8451811015610b1557826004868381518110610a0e57610a0e611413565b016020015182516001600160f81b031990911690911c60f81c908110610a3657610a36611413565b01602001516001600160f81b03191682610a518360026115a5565b610a5c906002611463565b81518110610a6c57610a6c611413565b60200101906001600160f81b031916908160001a90535082858281518110610a9657610a96611413565b602091010151815160f89190911c600f16908110610ab657610ab6611413565b01602001516001600160f81b03191682610ad18360026115a5565b610adc906003611463565b81518110610aec57610aec611413565b60200101906001600160f81b031916908160001a90535080610b0d81611476565b9150506109f0565b509392505050565b60006108ed838330610c35565b600083471015610b7c5760405162461bcd60e51b815260206004820152601d60248201527f437265617465323a20696e73756666696369656e742062616c616e63650000006044820152606401610282565b8151600003610bcd5760405162461bcd60e51b815260206004820181905260248201527f437265617465323a2062797465636f6465206c656e677468206973207a65726f6044820152606401610282565b8282516020840186f590506001600160a01b038116610c2e5760405162461bcd60e51b815260206004820152601960248201527f437265617465323a204661696c6564206f6e206465706c6f79000000000000006044820152606401610282565b9392505050565b6000604051836040820152846020820152828152600b8101905060ff815360559020949350505050565b634e487b7160e01b600052604160045260246000fd5b601f8201601f1916810167ffffffffffffffff81118282101715610c9b57610c9b610c5f565b6040525050565b600067ffffffffffffffff821115610cbc57610cbc610c5f565b50601f01601f191660200190565b600082601f830112610cdb57600080fd5b8135610ce681610ca2565b604051610cf38282610c75565b828152856020848701011115610d0857600080fd5b82602086016020830137600092810160200192909252509392505050565b8015158114610d3457600080fd5b50565b8035610d4281610d26565b919050565b60008060008060808587031215610d5d57600080fd5b84359350602085013567ffffffffffffffff80821115610d7c57600080fd5b610d8888838901610cca565b945060408701359150610d9a82610d26565b90925060608601359080821115610db057600080fd5b50610dbd87828801610cca565b91505092959194509250565b600067ffffffffffffffff821115610de357610de3610c5f565b5060051b60200190565b803561ffff81168114610d4257600080fd5b600080600080600060a08688031215610e1757600080fd5b853567ffffffffffffffff80821115610e2f57600080fd5b610e3b89838a01610cca565b9650602091508188013581811115610e5257600080fd5b8801601f81018a13610e6357600080fd5b8035610e6e81610dc9565b604051610e7b8282610c75565b82815260059290921b830185019185810191508c831115610e9b57600080fd5b8584015b83811015610ed357803586811115610eb75760008081fd5b610ec58f8983890101610cca565b845250918601918601610e9f565b50985050505060408801359450610eef91505060608701610ded565b949793965091946080013592915050565b600082601f830112610f1157600080fd5b81356020610f1e82610dc9565b604051610f2b8282610c75565b83815260059390931b8501820192828101915086841115610f4b57600080fd5b8286015b84811015610f6d57610f6081610ded565b8352918301918301610f4f565b509695505050505050565b600060208284031215610f8a57600080fd5b813567ffffffffffffffff811115610fa157600080fd5b610fad84828501610f00565b949350505050565b6001600160a01b0381168114610d3457600080fd5b600060208284031215610fdc57600080fd5b8135610c2e81610fb5565b600082601f830112610ff857600080fd5b8135602061100582610dc9565b6040516110128282610c75565b83815260059390931b850182019282810191508684111561103257600080fd5b8286015b84811015610f6d57803561104981610fb5565b8352918301918301611036565b60008060008060008060c0878903121561106f57600080fd5b863567ffffffffffffffff8082111561108757600080fd5b6110938a838b01610f00565b975060208901359150808211156110a957600080fd5b6110b58a838b01610fe7565b965060408901359150808211156110cb57600080fd5b6110d78a838b01610cca565b9550606089013594506110ec60808a01610d37565b935060a089013591508082111561110257600080fd5b5061110f89828a01610cca565b9150509295509295509295565b6000806040838503121561112f57600080fd5b82359150602083013567ffffffffffffffff81111561114d57600080fd5b61115985828601610cca565b9150509250929050565b60005b8381101561117e578181015183820152602001611166565b50506000910152565b6000815180845261119f816020860160208601611163565b601f01601f19169290920160200192915050565b828152604060208201526000610fad6040830184611187565b6000602082840312156111de57600080fd5b8151610c2e81610fb5565b600060033d11156112025760046000803e5060005160e01c5b90565b600060443d10156112135790565b6040516003193d81016004833e81513d67ffffffffffffffff816024840111818411171561124357505050505090565b828501915081518181111561125b5750505050505090565b843d87010160208285010111156112755750505050505090565b61128460208286010187610c75565b509095945050505050565b7202232b83637bcb6b2b73a103330b4b632b21d1606d1b8152600082516112bd816013850160208701611163565b9190910160130192915050565b6020815260006108ed6020830184611187565b7f4465706c6f796d656e74206661696c65642077697468206c6f772d6c6576656c81526701032b93937b91d160c51b602082015260008251611326816028850160208701611163565b9190910160280192915050565b60008251611345818460208701611163565b9190910192915050565b600082601f83011261136057600080fd5b815161136b81610ca2565b6040516113788282610c75565b82815285602084870101111561138d57600080fd5b6103c7836020830160208801611163565b600080600080608085870312156113b457600080fd5b845167ffffffffffffffff808211156113cc57600080fd5b6113d88883890161134f565b955060208701519450604087015191506113f182610d26565b60608701519193508082111561140657600080fd5b50610dbd8782880161134f565b634e487b7160e01b600052603260045260246000fd5b6000806040838503121561143c57600080fd5b505080516020909101519092909150565b634e487b7160e01b600052601160045260246000fd5b808201808211156108f0576108f061144d565b6000600182016114885761148861144d565b5060010190565b6080815260006114a26080830187611187565b856020840152841515604084015282810360608401526114c28185611187565b979650505050505050565b61ffff861681526001600160a01b038516602082015260a0604082018190526000906114fb90830186611187565b606083019490945250608001529392505050565b60006020828403121561152157600080fd5b815167ffffffffffffffff81168114610c2e57600080fd5b7f576f726d686f6c652072656c61796572206661696c656420666f722063686169815261037160f51b602082015261ffff60f01b8360f01b1660228201526101d160f51b602482015260008251611597816026850160208701611163565b919091016026019392505050565b80820281158282048414176108f0576108f061144d56fea26469706673582212206015cd4195f496e77bc213e9f2267eddacf0e17934f5dea7d1059f3a0a268cdc64736f6c63430008130033"
  const create2Deployer = await Create2Deployer.attach(CREATE2_DEPLOYER_ADDRESS);

  // Use a consistent salt across all deployments
  const salt = ethers.utils.id("WormholeDeployer_v1");

  // Check if the contract is already deployed
  const tx = await create2Deployer.deploy(0, salt, WormholeDeployer);
  await tx.wait();
  const bytecodehash = hre.ethers.utils.keccak256(WormholeDeployer);
  const address = await create2Deployer.computeAddress(salt, bytecodehash);
  console.log("wormholeDeployer address: ", address);
}

main().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});

  // const wormholeRelayerAddress = "0x7B1bD7a6b4E61c2a123AC6BC2cbfC614437D0470"; // Sepolia 11155111
  // const wormholeRelayerAddress = "0x7B1bD7a6b4E61c2a123AC6BC2cbfC614437D0470"; // Arbitrum 421614
  // const wormholeRelayerAddress = "0x93BAD53DDfB6132b0aC8E37f6029163E63372cEE"; // Optimism Sepolia 11155420
  // const wormholeRelayerAddress = "0x93BAD53DDfB6132b0aC8E37f6029163E63372cEE"; // Base Sepolia 84532
  // const wormholeRelayerAddress = "0x306B68267Deb7c5DfCDa3619E22E9Ca39C374f84"; // Alfajores 44787
  // const wormholeRelayerAddress = "0x0591C25ebd0580E0d4F27A82Fc2e24E7489CB5e0"; // Moonbase-Alphanet 1287
  // const wormholeRelayerAddress = "0xA3cF45939bD6260bcFe3D66bc73d60f19e49a8BB"; // Fuji 43113
  // const wormholeRelayerAddress = "0x80aC94316391752A193C1c47E27D382b507c93F3"; // BSC 97